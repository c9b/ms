<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل نتائج البلوت</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>تسجيل نتائج البلوت</h1>
        <form id="teamNamesForm">
            <div class="row">
                <div class="col">
                    <input type="text" id="team1Name" placeholder="الفريق 1" required>
                </div>
                <div class="col">
                    <input type="text" id="team2Name" placeholder="الفريق 2" required>
                </div>
            </div>
            <button type="submit">حفظ الأسماء</button>
        </form>

        <div id="resultsSection">
            <h2>تسجيل النقاط</h2>
            <form id="resultsForm">
                <div class="row">
                    <div class="col">
                        <label id="team1LabelAbove"></label>
                        <input type="number" id="points1" required>
                    </div>
                    <div class="col">
                        <label id="team2LabelAbove"></label>
                        <input type="number" id="points2" required>
                    </div>
                </div>
                <button type="submit">تسجيل النتيجة</button>
            </form>

            <h2>النتائج المسجلة</h2>
            <table>
                <thead>
                    <tr>
                        <th id="team1Header">نقاط الفريق 1</th>
                        <th id="team2Header">نقاط الفريق 2</th>
                        <th>إجراءات</th>
                    </tr>
                </thead>
                <tbody id="resultsTable"></tbody>
            </table>

            <h2>النقاط الإجمالية</h2>
            <div class="totals-container">
                <div class="total">
                    <h2><span id="team1Label"></span>: <span id="total1">0</span></h2>
                    <div class="progress">
                        <div class="progress-bar" id="progress1" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="total">
                    <h2><span id="team2Label"></span>: <span id="total2">0</span></h2>
                    <div class="progress">
                        <div class="progress-bar" id="progress2" style="width: 0%;"></div>
                    </div>
                </div>
            </div>

            <button id="resetBtn">إعادة تعيين</button>
        </div>
    </div>

    <!-- Modal -->
    <div id="winnerModal" class="modal">
        <div class="modal-content">
            <h5 class="modal-title">نتيجة المباراة</h5>
            <p id="modalMessage"></p>
            <div class="modal-footer">
                <button id="resetModalBtn">إعادة تعيين</button>
            </div>
        </div>
    </div>

    <script>
        let totalPoints1 = parseInt(localStorage.getItem('totalPoints1')) || 0;
        let totalPoints2 = parseInt(localStorage.getItem('totalPoints2')) || 0;
        let team1Name = localStorage.getItem('team1Name') || 'الفريق 1';
        let team2Name = localStorage.getItem('team2Name') || 'الفريق 2';
        let rounds = JSON.parse(localStorage.getItem('rounds')) || [];
        let winnerName = localStorage.getItem('winnerName') || null;

        document.addEventListener('DOMContentLoaded', function() {
            // تحديث أسماء الفرق المخزنة أو استخدام الافتراضية
            team1Name = localStorage.getItem('team1Name') || 'الفريق 1';
            team2Name = localStorage.getItem('team2Name') || 'الفريق 2';

            // تعيين الأسماء في الحقول المختلفة
            document.getElementById('team1LabelAbove').textContent = team1Name;
            document.getElementById('team2LabelAbove').textContent = team2Name;
            document.getElementById('team1Header').textContent = team1Name;
            document.getElementById('team2Header').textContent = team2Name;
            document.getElementById('team1Label').textContent = team1Name;
            document.getElementById('team2Label').textContent = team2Name;
            document.getElementById('total1').textContent = totalPoints1;
            document.getElementById('total2').textContent = totalPoints2;

            updateProgressBars();

            // عرض النتائج المخزنة مسبقًا
            rounds.forEach(round => {
                const newRow = `
                    <tr>
                        <td>${round.points1}</td>
                        <td>${round.points2}</td>
                        <td><button class="btn btn-danger" onclick="deleteRow(this, ${round.points1}, ${round.points2})">حذف</button></td>
                    </tr>
                `;
                document.getElementById('resultsTable').innerHTML += newRow;
            });

            // تحقق من أسماء الفرق في localStorage
            if (team1Name !== 'الفريق 1' && team2Name !== 'الفريق 2') {
                // إذا كانت الأسماء موجودة، إخفاء نموذج الأسماء وعرض النتائج
                document.getElementById('teamNamesForm').style.display = 'none';
                showResultsSection();
            } else {
                // إذا كانت الأسماء غير موجودة، تأكد من عرض صندوق الإدخال
                document.getElementById('teamNamesForm').style.display = 'block';
            }

            if (winnerName) {
                const modalMessage = document.getElementById("modalMessage");
                modalMessage.textContent = `${winnerName} فاز!`;
                $('#winnerModal').modal({
                    backdrop: 'static',
                    keyboard: false
                });
                $('#winnerModal').modal('show');
            }
        });


        document.getElementById('teamNamesForm').addEventListener('submit', function(e) {
            e.preventDefault();
            team1Name = document.getElementById('team1Name').value;
            team2Name = document.getElementById('team2Name').value;

            document.getElementById('team1Header').textContent = team1Name;
            document.getElementById('team2Header').textContent = team2Name;
            document.getElementById('team1Label').textContent = team1Name;
            document.getElementById('team2Label').textContent = team2Name;
            document.getElementById('team1LabelAbove').textContent = team1Name;
            document.getElementById('team2LabelAbove').textContent = team2Name;
            localStorage.setItem('team1Name', team1Name);
            localStorage.setItem('team2Name', team2Name);

            document.getElementById('teamNamesForm').style.display = 'none';
            showResultsSection();
        });

        document.getElementById('resultsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const points1 = parseInt(document.getElementById('points1').value);
            const points2 = parseInt(document.getElementById('points2').value);

            // التحقق من أن النقاط غير سالبة
            if (points1 < 0 || points2 < 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'خطأ!',
                    text: 'الرجاء إدخال نقاط صحيحة (غير سالبة).',
                });
                return;
            }



            const newRow = `
                <tr>
                    <td>${points1}</td>
                    <td>${points2}</td>
                    <td><button class="btn btn-danger" onclick="deleteRow(this, ${points1}, ${points2})">حذف</button></td>
                </tr>
            `;
            document.getElementById('resultsTable').innerHTML += newRow;

            totalPoints1 += points1;
            totalPoints2 += points2;

            document.getElementById('total1').textContent = totalPoints1;
            document.getElementById('total2').textContent = totalPoints2;

            rounds.push({
                points1,
                points2
            });
            localStorage.setItem('rounds', JSON.stringify(rounds));
            localStorage.setItem('totalPoints1', totalPoints1);
            localStorage.setItem('totalPoints2', totalPoints2);

            updateProgressBars();
            checkWinner();
            document.getElementById('points1').value = '';
            document.getElementById('points2').value = '';
        });

        function updateProgressBars() {
            const progress1 = (totalPoints1 / 152) * 100;
            const progress2 = (totalPoints2 / 152) * 100;

            document.getElementById('progress1').style.width = `${progress1}%`;
            document.getElementById('progress1').setAttribute('aria-valuenow', progress1);

            document.getElementById('progress2').style.width = `${progress2}%`;
            document.getElementById('progress2').setAttribute('aria-valuenow', progress2);
        }

        function checkWinner() {
            // تحقق إذا كانت النقاط أكبر من 152
            if (totalPoints1 >= 152 || totalPoints2 >= 152) {
                if (totalPoints1 > totalPoints2) {
                    winnerName = team1Name; // الفريق الأول هو الفائز
                    showWinnerMessage(winnerName);
                } else if (totalPoints2 > totalPoints1) {
                    winnerName = team2Name; // الفريق الثاني هو الفائز
                    showWinnerMessage(winnerName);
                } else {
                    // حالة التعادل، لا نعرض أي فائز
                    winnerName = null;
                    console.log("تعادل، تستمر الجولة.");
                }
            }
        }

        // دالة لإظهار رسالة الفائز
        function showWinnerMessage(winner) {
            if (winner) {
                localStorage.setItem('winnerName', winner);
                const modalMessage = document.getElementById("modalMessage");
                modalMessage.textContent = `${winner} فاز!`;
                $('#winnerModal').modal({
                    backdrop: 'static',
                    keyboard: false
                });
                $('#winnerModal').modal('show');
            }
        }


        document.getElementById('resetBtn').addEventListener('click', confirmReset);
        document.getElementById('resetModalBtn').addEventListener('click', confirmReset);

        function confirmReset() {
            const confirmAction = confirm("هل أنت متأكد أنك تريد إعادة تعيين السجل؟ لا يمكن التراجع عن هذا الإجراء.");
            if (confirmAction) {
                resetGame();
            }
        }

        function resetGame() {
            localStorage.clear();
            location.reload();
        }

        function deleteRow(button, points1, points2) {
            totalPoints1 -= points1;
            totalPoints2 -= points2;

            document.getElementById('total1').textContent = totalPoints1;
            document.getElementById('total2').textContent = totalPoints2;

            localStorage.setItem('totalPoints1', totalPoints1);
            localStorage.setItem('totalPoints2', totalPoints2);

            rounds = rounds.filter(round => !(round.points1 === points1 && round.points2 === points2));
            localStorage.setItem('rounds', JSON.stringify(rounds));

            const row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);

            updateProgressBars();
        }

        function showResultsSection() {
            document.getElementById('resultsSection').style.display = 'block';
        }


        document.getElementById('resultsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const points1 = parseInt(document.getElementById('points1').value);
            const points2 = parseInt(document.getElementById('points2').value);

            if (points1 < 0 || points2 < 0) {
                alert("الرجاء إدخال نقاط صحيحة (غير سالبة).");
                return;
            }

            // Proceed with adding points and updating totals...
        });
    </script>
</body>

</html>
